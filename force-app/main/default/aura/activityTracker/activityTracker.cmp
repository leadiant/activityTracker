<aura:component implements="force:appHostable,flexipage:availableForAllPageTypes" access="global" controller="activityTrackerApexController">

	<aura:attribute name="recordId" type="String" />
	<aura:attribute name="selectedAccountName" type="String" description="String value that holds the name of the selected contact's Account Name" />


	<aura:attribute name="newTask" type="Task" default="{ 'sobjectType': 'Task',
                             'Subject': 'Call',
                             'Status':'Completed', 
                             'Call_Type__c':'In-Person Visit',
                             'ONC_Type_Call__c':'Branded',
                             'Active_Product__c':'',
                             'WhoId': '', 
                             'WhatId': '',
                             'ActivityDate': '',
                             'ONC_Scientific_Topic__c':''
                             }" />


	<aura:attribute access="private" name="modal" type="Aura.Component" />
	<aura:attribute access="private" name="addMaterialItemComponent" type="Aura.Component" />
	<aura:attribute access="private" name="materialItem" type="Material_Items__c" default="{}" />
	<aura:attribute name="materialItems" type="Material_Items__c[]" />


	<aura:handler name="init" value="{!this}" action="{!c.doInit}" />
	<aura:attribute name="taskPicklistValues" type="Object" description="To store fields picklist values." />
	<c:taskDataService aura:id="taskDataService" />

	<aura:handler name="change" value="{!v.newTask.WhoId}" action="{!c.getContactProduct}" />
	<aura:handler name="change" value="{!v.newTask.Status}" action="{!c.handleTaskStatusChange}" />

	<aura:dependency resource="markup://c:toaster" type="COMPONENT" />
	<aura:dependency resource="markup://c:product" type="COMPONENT" />

	<div class="slds-page-header">

		<!-- PAGE HEADER TOP ROW -->
		<div class="slds-grid">
			<div class="slds-col slds-has-flexi-truncate">
				<!-- HEADING AREA -->
				<!-- MEDIA OBJECT = FIGURE + BODY -->
				<div class="slds-media slds-no-space slds-grow">
					<div class="slds-media__figure">
						<lightning:icon iconName="standard:call" alternativeText="Call" />
					</div>

					<div class="slds-media__body">
						<p class="slds-text-title--caps slds-line-height--reset">Log a Call
						</p>
						<h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate" title="Leadiant Bioscience Inc.">Track Activities and Material Items.</h1>
					</div>
				</div>
				<!-- / MEDIA OBJECT -->
				<!-- HEADING AREA -->

			</div>
			<!-- / PAGE HEADER / ROW 1 / COLUMN 1 -->
			<!-- PAGE HEADER / ROW 1 / COLUMN 2 -->
			<div class="slds-col slds-no-flex slds-grid slds-align-top">
				<lightning:button variant="brand" class="slds-button slds-button--neutral slds-m-top--medium" label="Save" disabled="{! or(empty(v.newTask.Active_Product__c),empty(v.newTask.WhoId) ) ? true : false}" onclick="{!c.handleClickSave}" />
				<lightning:button variant="brand" class="slds-button slds-button--neutral slds-m-top--medium" label="Add Material Item" onclick="{!c.handleClickOpenModal}" disabled="{! or(empty(v.newTask.Active_Product__c),equals(v.newTask.Status,'Open') ) ? true : false}"
				/>
				<lightning:button variant="brand" type="reset" class="slds-button slds-button--neutral slds-m-top--medium" label="Cancel" onclick="{!c.handleClickCancel}" />
			</div>
			<!-- / PAGE HEADER / ROW 1 / COLUMN 2 -->

		</div>
		<!-- / PAGE HEADER TOP ROW -->

	</div>

	<c:toaster aura:id="toaster" />

	<div class="slds-grid slds-m-top--small slds-card">
		<div class="slds-col slds-p-top--medium slds-p-left--medium slds-p-right--medium slds-p-bottom--medium">
			<div class="slds-form slds-form_compound" id="add-task-form">
				<div class="slds-form-element__group">
					<div class="slds-form-element__row">
						<c:strike_lookup disabled="{! empty(v.recordId)  ? false : true}" class="slds-size_1-of-2" aura:id="contactLookup" label="Contact:" object="Contact" value="{!v.newTask.WhoId}" valueSublabel="{!v.selectedAccountName}" searchField="Name" placeholder="Please enter minimum of two characters"
						 iconName="standard:contact" subtitleField="Account.Name" order="Name" limit="5" loadingMessage="Loading..." required="true" errorMessage="Invalid input" showRecentRecords="true" />
						<lightning:input aura:id="accountName" name="accountName" label="Account Name:" placeholder="Account Name" class="slds-size_1-of-2" value="{!v.selectedAccountName}" disabled="true" />
					</div>
				</div>

				<div class="slds-form-element__group">
					<div class="slds-form-element__row">
						<lightning:select name="statusSelect" label="Status:" required="true" class="slds-size_1-of-2" aura:id="statusSelect" value="{!v.newTask.Status}">
							<aura:iteration items="{!v.taskPicklistValues.activityStatus}" var="item">
								<aura:if isTrue="{!equals(item,'Completed')}">
									<option text="{!item}" value="{!item}" Selected="true" />
									<aura:set attribute="else">
										<option text="{!item}" value="{!item}" Selected="false" />
									</aura:set>
								</aura:if>
							</aura:iteration>
						</lightning:select>


						<lightning:select name="subjectSelect" class="slds-size_1-of-2" label="Subject:" required="true" aura:id="subjectSelect" value="{!v.newTask.Subject}">
							<aura:iteration items="{!v.taskPicklistValues.activitySubject}" var="item">
								<aura:if isTrue="{!equals(item,'Call')}">
									<option text="{!item}" value="{!item}" Selected="true" />
									<aura:set attribute="else">
										<option text="{!item}" value="{!item}" Selected="false" />
									</aura:set>
								</aura:if>
							</aura:iteration>
						</lightning:select>
					</div>
				</div>


				<div class="slds-form-element__group">
					<div class="slds-form-element__row">
						<lightning:select class="slds-size_1-of-2" name="callTypeSelect" label="Call Type:" required="true" aura:id="callTypeSelect" value="{!v.newTask.Call_Type__c}">
							<aura:iteration items="{!v.taskPicklistValues.activityCallType}" var="item">
								<aura:if isTrue="{!equals(item,'In-Person Visit')}">
									<option text="{!item}" value="{!item}" Selected="true" />
									<aura:set attribute="else">
										<option text="{!item}" value="{!item}" Selected="false" />
									</aura:set>
								</aura:if>
							</aura:iteration>
						</lightning:select>

						<c:strike_datepicker label="Due Date" aura:id="dueDate" required="true" placeholder="Please provide Activity Date" valueFormat="yyyy-MM-dd" disabled="false" error="false" value="{!v.newTask.ActivityDate}" />

					</div>
				</div>

				<div class="slds-form-element__group">
					<div class="slds-form-element__row">

						<lightning:select class="slds-size_1-of-2" name="typeOfCallSelect" label="Type Of Call:" required="true" aura:id="typeOfCallSelect" value="{!v.newTask.ONC_Type_Call__c}">
							<aura:iteration items="{!v. taskPicklistValues.activityONCType}" var="item">
								<aura:if isTrue="{!equals(item,'Branded')}">
									<option text="{!item}" value="{!item}" Selected="true" />
									<aura:set attribute="else">
										<option text="{!item}" value="{!item}" Selected="false" />
									</aura:set>
								</aura:if>
							</aura:iteration>
						</lightning:select>

						<c:product aura:id="product" cssClass="slds-size_1-of-2" productValue="{!v.newTask.Active_Product__c}" />
					</div>
				</div>
				<div class="slds-form-element">
					<div class="slds-form-element__control">
						<c:strike_multiSelectPicklist label="Scientific Topic:" aura:id="scientificTopicSelect" 
						value="{!v.newTask.ONC_Scientific_Topic__c}" helpText="Click on the box below to select Scientific Topics">
							<aura:iteration items="{!v.taskPicklistValues.activityONCScienceType}" var="item">
								<c:strike_option label="{!item}" value="{!item}" />
							</aura:iteration>
						</c:strike_multiSelectPicklist>

					</div>
				</div>
			</div>
		</div>
	</div>



	<aura:if isTrue="{!v.materialItems.length > 0}">
		<div class="slds-grid slds-m-top--small">
			<div class="slds-col">
				<article class="slds-card">
					<div class="slds-card__header slds-grid">
						<header class="slds-media slds-media--center slds-has-flexi-truncate">
							<div class="slds-media__figure">
								<lightning:icon iconName="standard:product_item_transaction" alternativeText="Call" /> </div>
							<div class="slds-media__body slds-truncate">
								<a href="javascript:void(0);" class="slds-text-link--reset">
                            <span class="slds-text-heading--small">Material Items</span>
                        </a>
							</div>
						</header>
					</div>

					<div class="slds-card__body">
						<table class="slds-table slds-table_bordered slds-table_cell-buffer">
							<thead>
								<tr class="slds-text-heading--label">
									<c:DataTableColumn isHeader="true" label="Item" title="Item">Item</c:DataTableColumn>
									<c:DataTableColumn isHeader="true" label="Quantity" title="Quantity">Quantity</c:DataTableColumn>
									<c:DataTableColumn isHeader="true" label="DATE PROVIDED" title="DATE PROVIDED">DATE PROVIDED</c:DataTableColumn>
									<c:DataTableColumn isHeader="true" label="SOURCE TYPE" title="SOURCE TYPE">SOURCE TYPE</c:DataTableColumn>
									<c:DataTableColumn isHeader="true" label="AMOUNT" title="AMOUNT">AMOUNT</c:DataTableColumn>
									<c:DataTableColumn isHeader="true" label="Select All" title="Select All"></c:DataTableColumn>
								</tr>
							</thead>
							<tbody>
								<aura:iteration items="{!v.materialItems}" var="row" indexVar="index">
									<tr>
										<c:DataTableColumn label="Status" title="{!row.Item_Description__c}">{!row.Item_Description__c}</c:DataTableColumn>
										<c:DataTableColumn label="Status" title="{!row.Quantity__c}">{!row.Quantity__c}</c:DataTableColumn>
										<c:DataTableColumn label="Class" title="{!row.Date_Provided__c}">{!row.Date_Provided__c}</c:DataTableColumn>
										<c:DataTableColumn label="Cron" title="{!row.Source_Type__c}">{!row.Source_Type__c}</c:DataTableColumn>
										<c:DataTableColumn label="Cron" title="{!row.Amount__c}">{!row.Amount__c}</c:DataTableColumn>
										<c:DataTableColumn label="Name" title="{!row.name}">
											<lightning:buttonIcon iconName="utility:clear" variant="bare" alternativeText="Clear" iconClass="dark" onclick="{!c.handleClearClick }" value="{!index}" />
										</c:DataTableColumn>
									</tr>
								</aura:iteration>
							</tbody>
						</table>

					</div>
				</article>
			</div>
		</div>
	</aura:if>


	<c:strike_modal aura:id="newMaterialItemModal" title="Add Material Item">
		<aura:set attribute="footerButtons">
			<div class="slds-modal__footer--directional">
				<lightning:button variant="neutral" label="Cancel" onclick="{!c.handleClickCancel}" />
				<lightning:button variant="brand" label="Save" onclick="{!c.handleCreateMaterialItem}" />
			</div>
		</aura:set>
	</c:strike_modal>
	
	<c:Spinner aura:id="spinner"/>

</aura:component>